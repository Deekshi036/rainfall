<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåæ Agricultural Rainfall Analysis System - India</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <header class="header">
            <div class="header-content">
                <h1>üåæ Agricultural Rainfall Analysis System</h1>
                <p class="subtitle">Exploratory Analysis of Rainfall Data in India for Agriculture</p>
                <p class="description">AI-powered insights for crop planning, irrigation management, and agricultural risk assessment</p>
            </div>
        </header>

        <!-- Alert Messages -->
        {% if error %}
        <div class="alert alert-error">
            <strong>‚ö†Ô∏è Error:</strong> {{ error }}
        </div>
        {% endif %}

        {% if result %}
        <div class="result-card">
            <div class="result-header">
                <h2>üìä Agricultural Analysis Results</h2>
                <div class="result-meta">
                    <span class="location-badge">üìç {{ result.location }}</span>
                    <span class="timestamp">{{ result.timestamp }}</span>
                </div>
            </div>
            
            <!-- Rainfall Prediction -->
            <div class="prediction-result {{ 'rain' if result.prediction_class == 1 else 'no-rain' }}">
                <div class="prediction-icon">
                    {% if result.prediction_class == 1 %}
                        ‚òî
                    {% else %}
                        ‚òÄÔ∏è
                    {% endif %}
                </div>
                <div class="prediction-text">
                    <h3>{{ result.prediction }}</h3>
                    {% if result.confidence %}
                    <p class="confidence">Prediction Confidence: <strong>{{ result.confidence }}%</strong></p>
                    {% endif %}
                </div>
            </div>

            {% if result.prob_rain and result.prob_no_rain %}
            <div class="probability-bars">
                <div class="prob-item">
                    <div class="prob-label">
                        <span>‚òî Rainfall Probability</span>
                        <strong>{{ result.prob_rain }}%</strong>
                    </div>
                    <div class="prob-bar">
                        <div class="prob-fill rain-fill" data-width="{{ result.prob_rain | default(0) | int }}"></div>
                    </div>
                </div>

                <div class="prob-item">
                    <div class="prob-label">
                        <span>‚òÄÔ∏è No Rainfall Probability</span>
                        <strong>{{ result.prob_no_rain }}%</strong>
                    </div>
                    <div class="prob-bar">
                        <div class="prob-fill no-rain-fill" data-width="{{ result.prob_no_rain | default(0) | int }}"></div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Agricultural Recommendations -->
            <div class="recommendations-section">
                <h3>üåæ Agricultural Recommendations for {{ result.location }}</h3>
                
                {% if result.prediction_class == 1 %}
                <!-- Rain Expected -->
                <div class="recommendation-card rain-recommendation">
                    <h4>üåßÔ∏è Rainfall Expected - Action Plan</h4>
                    <div class="rec-category">
                        <h5>üå± Crop Planning</h5>
                        <ul>
                            <li><strong>Suitable Crops:</strong> Rice, millets, pulses, cotton</li>
                            <li><strong>Planting Schedule:</strong> Optimal time for monsoon crops</li>
                            <li><strong>Field Preparation:</strong> Ensure drainage systems</li>
                        </ul>
                    </div>
                    <div class="rec-category">
                        <h5>üíß Irrigation Management</h5>
                        <ul>
                            <li><strong>Action:</strong> Reduce or suspend irrigation</li>
                            <li><strong>Water Storage:</strong> Prepare rainwater harvesting</li>
                            <li><strong>Drainage:</strong> Clear field drainage channels</li>
                        </ul>
                    </div>
                    <div class="rec-category">
                        <h5>‚ö†Ô∏è Risk Assessment</h5>
                        <ul>
                            <li><strong>Risk Level:</strong> <span class="risk-badge low-risk">Low drought risk</span></li>
                            <li><strong>Waterlogging:</strong> <span class="risk-badge medium-risk">Monitor excess water</span></li>
                        </ul>
                    </div>
                </div>
                {% else %}
                <!-- No Rain Expected -->
                <div class="recommendation-card no-rain-recommendation">
                    <h4>‚òÄÔ∏è No Rainfall Expected - Action Plan</h4>
                    <div class="rec-category">
                        <h5>üå± Crop Planning</h5>
                        <ul>
                            <li><strong>Suitable Crops:</strong> Bajra, jowar, groundnut (drought-resistant)</li>
                            <li><strong>Seed Selection:</strong> Drought-tolerant varieties</li>
                            <li><strong>Field Preparation:</strong> Apply mulching for moisture</li>
                        </ul>
                    </div>
                    <div class="rec-category">
                        <h5>üíß Irrigation Management</h5>
                        <ul>
                            <li><strong>Action:</strong> Increase irrigation frequency</li>
                            <li><strong>Water Conservation:</strong> Use drip/sprinkler systems</li>
                            <li><strong>Monitor:</strong> Check soil moisture regularly</li>
                        </ul>
                    </div>
                    <div class="rec-category">
                        <h5>‚ö†Ô∏è Risk Assessment</h5>
                        <ul>
                            <li><strong>Risk Level:</strong> <span class="risk-badge high-risk">Drought conditions</span></li>
                            <li><strong>Action:</strong> <span class="risk-badge high-risk">Monitor crops closely</span></li>
                        </ul>
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="action-buttons">
                <button onclick="window.location.href='/'" class="btn btn-secondary">üîÑ New Analysis</button>
            </div>
        </div>
        {% endif %}

        <!-- Mode Selection Tabs -->
        <div class="form-card">
            <h2>üìù Choose Your Input Method</h2>
            <p class="form-instruction">Select the method that works best for you</p>
            
            <!-- Tab Buttons -->
            <div class="mode-tabs">
                <button class="mode-tab active" onclick="switchMode('simple')" id="simple-tab">
                    <span class="tab-icon">üë®‚Äçüåæ</span>
                    <span class="tab-title">Simple Mode</span>
                    <span class="tab-desc">For Farmers - Just select location</span>
                </button>
                <button class="mode-tab" onclick="switchMode('advanced')" id="advanced-tab">
                    <span class="tab-icon">üìä</span>
                    <span class="tab-title">Advanced Mode</span>
                    <span class="tab-desc">For Experts - Enter all weather data</span>
                </button>
            </div>

            <!-- Simple Mode Form -->
            <div id="simple-mode" class="mode-content active">
                <div class="simple-mode-card">
                    <h3>üåç Location-Based Prediction</h3>
                    <p class="mode-description">Perfect for farmers! Just select your location and we'll use typical weather patterns to make a prediction.</p>
                    
                    <form method="POST" action="/predict-simple" id="simpleForm">
                        <div class="location-section-simple">
                            <label for="Location_Simple" class="location-label">
                                <span class="label-icon">üìç</span>
                                <span class="label-text">Select Your Location</span>
                                <span class="required">*</span>
                            </label>
                            <select name="Location" id="Location_Simple" class="location-select" required>
                                <option value="">-- Choose your city/village --</option>
                                {% for loc in locations %}
                                <option value="{{ loc }}">{{ loc }}</option>
                                {% endfor %}
                            </select>
                            <small class="helper-text">We'll use historical weather patterns for this location</small>
                        </div>

                        <div class="simple-note">
                            <div class="note-icon">üí°</div>
                            <div class="note-content">
                                <strong>How it works:</strong> We analyze historical rainfall patterns for your selected location to predict tomorrow's rainfall. This is based on typical weather behavior in your region.
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-large">
                                üîÆ Predict Rainfall (Quick)
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Advanced Mode Form -->
            <div id="advanced-mode" class="mode-content">
                <div class="advanced-mode-card">
                    <h3>üìä Detailed Weather Analysis</h3>
                    <p class="mode-description">For agricultural experts and those with access to weather measurements. Provides more accurate predictions.</p>
                    
                    <form method="POST" action="/predict" id="advancedForm">
                        <!-- Location Selection -->
                        <div class="location-section">
                            <label for="Location_Advanced" class="location-label">
                                <span class="label-icon">üìç</span>
                                <span class="label-text">Select Your Location</span>
                                <span class="required">*</span>
                            </label>
                            <select name="Location" id="Location_Advanced" class="location-select" required>
                                <option value="">-- Choose your city/location --</option>
                                {% for loc in locations %}
                                <option value="{{ loc }}" {% if form_data and form_data.Location == loc %}selected{% endif %}>
                                    {{ loc }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Weather Parameters Grid -->
                        <div class="form-grid">
                            <!-- Temperature Section -->
                            <div class="form-section">
                                <h3 class="section-title">üå°Ô∏è Temperature (¬∞C)</h3>
                                <div class="form-group">
                                    <label for="MinTemp">Minimum Temperature</label>
                                    <input type="number" step="0.1" name="MinTemp" id="MinTemp" 
                                           value="{{ form_data.MinTemp if form_data else '' }}" 
                                           placeholder="e.g., 13.4" required>
                                </div>
                                <div class="form-group">
                                    <label for="MaxTemp">Maximum Temperature</label>
                                    <input type="number" step="0.1" name="MaxTemp" id="MaxTemp" 
                                           value="{{ form_data.MaxTemp if form_data else '' }}" 
                                           placeholder="e.g., 26.9" required>
                                </div>
                                <div class="form-group">
                                    <label for="Temp9am">Temperature at 9am</label>
                                    <input type="number" step="0.1" name="Temp9am" id="Temp9am" 
                                           value="{{ form_data.Temp9am if form_data else '' }}" 
                                           placeholder="e.g., 16.9" required>
                                </div>
                                <div class="form-group">
                                    <label for="Temp3pm">Temperature at 3pm</label>
                                    <input type="number" step="0.1" name="Temp3pm" id="Temp3pm" 
                                           value="{{ form_data.Temp3pm if form_data else '' }}" 
                                           placeholder="e.g., 21.8" required>
                                </div>
                            </div>

                            <!-- Rainfall & Wind -->
                            <div class="form-section">
                                <h3 class="section-title">üåßÔ∏è Rainfall (mm)</h3>
                                <div class="form-group">
                                    <label for="Rainfall">Today's Rainfall</label>
                                    <input type="number" step="0.1" name="Rainfall" id="Rainfall" 
                                           value="{{ form_data.Rainfall if form_data else '' }}" 
                                           placeholder="e.g., 0.6" required>
                                </div>
                                
                                <h3 class="section-title" style="margin-top: 1.5rem;">üí® Wind Speed (km/h)</h3>
                                <div class="form-group">
                                    <label for="WindGustSpeed">Wind Gust Speed</label>
                                    <input type="number" step="0.1" name="WindGustSpeed" id="WindGustSpeed" 
                                           value="{{ form_data.WindGustSpeed if form_data else '' }}" 
                                           placeholder="e.g., 44.0" required>
                                </div>
                                <div class="form-group">
                                    <label for="WindSpeed9am">Wind Speed at 9am</label>
                                    <input type="number" step="0.1" name="WindSpeed9am" id="WindSpeed9am" 
                                           value="{{ form_data.WindSpeed9am if form_data else '' }}" 
                                           placeholder="e.g., 20.0" required>
                                </div>
                                <div class="form-group">
                                    <label for="WindSpeed3pm">Wind Speed at 3pm</label>
                                    <input type="number" step="0.1" name="WindSpeed3pm" id="WindSpeed3pm" 
                                           value="{{ form_data.WindSpeed3pm if form_data else '' }}" 
                                           placeholder="e.g., 24.0" required>
                                </div>
                            </div>

                            <!-- Humidity -->
                            <div class="form-section">
                                <h3 class="section-title">üíß Humidity (%)</h3>
                                <div class="form-group">
                                    <label for="Humidity9am">Humidity at 9am</label>
                                    <input type="number" step="0.1" name="Humidity9am" id="Humidity9am" 
                                           value="{{ form_data.Humidity9am if form_data else '' }}" 
                                           placeholder="e.g., 71.0" required min="0" max="100">
                                </div>
                                <div class="form-group">
                                    <label for="Humidity3pm">Humidity at 3pm</label>
                                    <input type="number" step="0.1" name="Humidity3pm" id="Humidity3pm" 
                                           value="{{ form_data.Humidity3pm if form_data else '' }}" 
                                           placeholder="e.g., 48.0" required min="0" max="100">
                                </div>
                            </div>

                            <!-- Pressure -->
                            <div class="form-section">
                                <h3 class="section-title">üî¨ Pressure (hPa)</h3>
                                <div class="form-group">
                                    <label for="Pressure9am">Pressure at 9am</label>
                                    <input type="number" step="0.1" name="Pressure9am" id="Pressure9am" 
                                           value="{{ form_data.Pressure9am if form_data else '' }}" 
                                           placeholder="e.g., 1007.7" required>
                                </div>
                                <div class="form-group">
                                    <label for="Pressure3pm">Pressure at 3pm</label>
                                    <input type="number" step="0.1" name="Pressure3pm" id="Pressure3pm" 
                                           value="{{ form_data.Pressure3pm if form_data else '' }}" 
                                           placeholder="e.g., 1007.1" required>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-large">
                                üîç Analyze Weather Data (Detailed)
                            </button>
                            <button type="button" onclick="clearAdvancedForm()" class="btn btn-secondary">
                                üîÑ Clear Form
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Info Section -->
        <div class="info-card">
            <h3>‚ÑπÔ∏è Which Mode Should I Use?</h3>
            
            <div class="info-grid">
                <div class="info-item mode-info">
                    <h4>üë®‚Äçüåæ Simple Mode - For Farmers</h4>
                    <p><strong>Best for:</strong> Farmers, village communities, general users</p>
                    <p><strong>What you need:</strong> Just know your location</p>
                    <p><strong>Accuracy:</strong> Good (based on historical patterns)</p>
                    <p><strong>Time needed:</strong> 10 seconds</p>
                </div>
                
                <div class="info-item mode-info">
                    <h4>üìä Advanced Mode - For Experts</h4>
                    <p><strong>Best for:</strong> Agricultural experts, meteorologists, researchers</p>
                    <p><strong>What you need:</strong> Current weather measurements</p>
                    <p><strong>Accuracy:</strong> Excellent (based on actual data)</p>
                    <p><strong>Time needed:</strong> 2-3 minutes</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>üåæ Agricultural Rainfall Analysis System for India | Powered by Machine Learning</p>
            <p class="footer-small">Helping farmers and experts make better agricultural decisions</p>
        </footer>
    </div>

    <script>
        // Mode switching
        function switchMode(mode) {
            // Update tabs
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(mode + '-tab').classList.add('active');
            
            // Update content
            document.querySelectorAll('.mode-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(mode + '-mode').classList.add('active');
        }

        // Clear advanced form
        function clearAdvancedForm() {
            document.getElementById('advancedForm').reset();
        }

        // Form validation for advanced mode
        document.getElementById('advancedForm').addEventListener('submit', function(e) {
            const inputs = this.querySelectorAll('input[required], select[required]');
            let isValid = true;
            
            inputs.forEach(input => {
                if (!input.value.trim()) {
                    isValid = false;
                    input.classList.add('error');
                } else {
                    input.classList.remove('error');
                }
            });
            
            if (!isValid) {
                e.preventDefault();
                alert('‚ö†Ô∏è Please fill in all required fields');
            }
        });

        // Form validation for simple mode
        document.getElementById('simpleForm').addEventListener('submit', function(e) {
            const location = document.getElementById('Location_Simple').value;
            if (!location) {
                e.preventDefault();
                alert('‚ö†Ô∏è Please select your location');
                document.getElementById('Location_Simple').classList.add('error');
            }
        });

        // Clear error highlighting
        document.querySelectorAll('input, select').forEach(input => {
            input.addEventListener('change', function() {
                this.classList.remove('error');
            });
        });

        // Smooth scroll to results
        document.addEventListener("DOMContentLoaded", function () {
            const resultCard = document.querySelector('.result-card');
            if (resultCard) {
                resultCard.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
            
            // Set probability bar widths
            document.querySelectorAll('.prob-fill[data-width]').forEach(function (el) {
                var v = el.getAttribute('data-width');
                if (!v) v = '0';
                el.style.width = v + '%';
            });
        });
    </script>
</body>
</html>